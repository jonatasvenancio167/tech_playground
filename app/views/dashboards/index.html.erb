<div class="dashboard-container">
  <!-- Header -->
  <div class="dashboard-header">
    <h1><%= t('dashboard.title') %></h1>
    <p class="subtitle"><%= t('dashboard.subtitle') %></p>
  </div>

  <!-- Filters -->
  <%= render "shared/filters", filters: @filters %>

  <!-- Executive Summary Cards -->
  <div class="metrics-grid">
    <div class="metric-card">
      <div class="metric-icon">üë•</div>
      <div class="metric-content">
        <div class="metric-value"><%= @executive[:headline_metrics][:total_employees] %></div>
        <div class="metric-label"><%= t('dashboard.total_employees') %></div>
      </div>
    </div>

    <div class="metric-card">
      <div class="metric-icon">üìà</div>
      <div class="metric-content">
        <div class="metric-value"><%= number_to_percentage(@executive[:headline_metrics][:response_rate], precision: 1) %></div>
        <div class="metric-label"><%= t('dashboard.response_rate') %></div>
      </div>
    </div>

    <div class="metric-card <%= enps_class(@executive[:headline_metrics][:enps_score]) %>">
      <div class="metric-icon">‚≠ê</div>
      <div class="metric-content">
        <div class="metric-value"><%= number_with_precision(@executive[:headline_metrics][:enps_score], precision: 1) %></div>
        <div class="metric-label"><%= t('dashboard.enps_score') %></div>
        <div class="metric-badge"><%= t("enps_levels.#{@executive[:headline_metrics][:enps_level]}") %></div>
      </div>
    </div>

    <div class="metric-card">
      <div class="metric-icon">üíØ</div>
      <div class="metric-content">
        <div class="metric-value"><%= number_to_percentage(@executive[:headline_metrics][:overall_favorability], precision: 1) %></div>
        <div class="metric-label"><%= t('dashboard.overall_favorability') %></div>
      </div>
    </div>
  </div>

  <!-- Critical Alerts -->
  <% if @executive[:critical_alerts].any? %>
    <div class="alerts-section">
      <h2><%= t('dashboard.critical_alerts') %></h2>
      <div class="alerts-list">
        <% @executive[:critical_alerts].each do |alert| %>
          <div class="alert alert-<%= alert[:severity] %>">
            <strong><%= alert[:type].titleize %>:</strong>
            <%= alert[:message] %>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>

  <!-- Strengths & Improvements -->
  <div class="insights-grid">
    <!-- Top Strengths -->
    <div class="insight-card">
      <h3><%= t('dashboard.top_strengths') %></h3>
      <div class="dimension-list">
        <% @executive[:top_strengths].each do |dimension, data| %>
          <div class="dimension-item">
            <div class="dimension-name"><%= t("dimensions.#{dimension}", default: dimension.to_s.titleize) %></div>
            <div class="dimension-bar">
              <div class="bar-fill" style="width: <%= data[:percentage] %>%"></div>
              <span class="bar-label"><%= number_to_percentage(data[:percentage], precision: 1) %></span>
            </div>
          </div>
        <% end %>
      </div>
    </div>

    <!-- Improvement Areas -->
    <div class="insight-card">
      <h3><%= t('dashboard.improvement_areas') %></h3>
      <div class="dimension-list">
        <% @executive[:improvement_areas].each do |dimension, data| %>
          <div class="dimension-item">
            <div class="dimension-name"><%= t("dimensions.#{dimension}", default: dimension.to_s.titleize) %></div>
            <div class="dimension-bar warning">
              <div class="bar-fill" style="width: <%= data[:percentage] %>%"></div>
              <span class="bar-label"><%= number_to_percentage(data[:percentage], precision: 1) %></span>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>

  <!-- Charts Section -->
  <div class="charts-section">
    <!-- eNPS Distribution -->
    <div class="chart-card">
      <h3><%= t('dashboard.enps_distribution') %></h3>
      <%= column_chart @overview[:enps].slice(:promoters, :passives, :detractors).transform_values { |v| v[:count] },
          colors: ["#10b981", "#f59e0b", "#ef4444"],
          library: {
            legend: { position: 'bottom' },
            title: { display: false }
          } %>
    </div>

    <!-- Favorability by Dimension -->
    <div class="chart-card">
      <h3><%= t('dashboard.favorability_by_dimension') %></h3>
      <%= bar_chart @overview[:favorability].transform_values { |v| v[:percentage] },
          colors: ["#3b82f6"],
          library: {
            legend: { display: false },
            scales: {
              y: {
                beginAtZero: true,
                max: 100,
                ticks: { callback: "function(value) { return value + '%'; }" }
              }
            }
          } %>
    </div>
  </div>

  <!-- Navigation Links -->
  <div class="nav-cards">
    <%= link_to company_dashboards_path, class: "nav-card" do %>
      <div class="nav-icon">üè¢</div>
      <div class="nav-content">
        <h4><%= t('dashboard.company_overview.title') %></h4>
        <p><%= t('dashboard.company_overview.description') %></p>
      </div>
    <% end %>

    <%= link_to departments_dashboards_path, class: "nav-card" do %>
      <div class="nav-icon">üèóÔ∏è</div>
      <div class="nav-content">
        <h4><%= t('dashboard.department_breakdown.title') %></h4>
        <p><%= t('dashboard.department_breakdown.description') %></p>
      </div>
    <% end %>

    <%= link_to trends_dashboards_path, class: "nav-card" do %>
      <div class="nav-icon">üìà</div>
      <div class="nav-content">
        <h4><%= t('dashboard.trends_history.title') %></h4>
        <p><%= t('dashboard.trends_history.description') %></p>
      </div>
    <% end %>
  </div>

  <!-- Timestamp -->
  <div class="dashboard-footer">
    <small><%= t('dashboard.last_updated') %>: <%= l(@overview[:timestamp], format: :default) %></small>
  </div>
</div>

<%= render "shared/dashboard_styles" %>
